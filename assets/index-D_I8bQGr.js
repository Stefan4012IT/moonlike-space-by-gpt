(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();let c,l,L=[],y=[],f;function P(e){l=e,c=l.getContext("2d");function t(){l.width=window.innerWidth,l.height=window.innerHeight}t(),window.addEventListener("resize",t);const s=150;L=[];for(let i=0;i<s;i++)L.push({x:Math.random()*l.width,y:Math.random()*l.height,radius:Math.random()*1.5,alpha:Math.random(),delta:Math.random()*.02});l.addEventListener("mousemove",i=>{y.push({x:i.clientX,y:i.clientY,alpha:1,radius:Math.random()*4+1})})}function g(){c.clearRect(0,0,l.width,l.height);for(let e of L)e.alpha+=e.delta,(e.alpha<=0||e.alpha>=1)&&(e.delta*=-1),c.beginPath(),c.arc(e.x,e.y,e.radius,0,Math.PI*2),c.fillStyle=`rgba(255, 255, 255, ${e.alpha})`,c.fill();for(let e=0;e<y.length;e++){const t=y[e];c.beginPath(),c.arc(t.x,t.y,t.radius,0,Math.PI*2),c.fillStyle=`rgba(173, 216, 230, ${t.alpha})`,c.fill(),t.alpha-=.02,t.alpha<=0&&(y.splice(e,1),e--)}f=requestAnimationFrame(g)}function Y(){const e=document.getElementById("stars");if(!e)return;const t=e.getContext("2d"),s=[];for(let o=0;o<300;o++)s.push({x:Math.random()*e.width-e.width/2,y:Math.random()*e.height-e.height/2,z:Math.random()*e.width/2});function i(){t.clearRect(0,0,e.width,e.height);for(let o of s){o.z-=.5,o.z<=.1&&(o.x=Math.random()*e.width-e.width/2,o.y=Math.random()*e.height-e.height/2,o.z=e.width/2);const n=o.x/o.z*e.width+e.width/2,a=o.y/o.z*e.height+e.height/2,r=(1-o.z/(e.width/2))*2;t.beginPath(),t.arc(n,a,r,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.6)",t.fill()}requestAnimationFrame(i)}i()}function O(){f&&(cancelAnimationFrame(f),f=null)}let b,m;function q(e){m=e,b=m.getContext("2d"),t(),window.addEventListener("resize",t);function t(){m.width=window.innerWidth,m.height=window.innerHeight}const s=[];window.addEventListener("mousemove",n=>{s.push({x:n.clientX,y:n.clientY,alpha:1,size:8+Math.random()*4,angle:0})});function i(n,a,r,d,h){n.save(),n.translate(a,r),n.scale(d/10,d/10),n.beginPath(),n.moveTo(0,0),n.bezierCurveTo(-1,-1,-2,1,0,2),n.bezierCurveTo(2,1,1,-1,0,0),n.closePath(),n.strokeStyle=`rgba(0, 255, 255, ${h})`,n.lineWidth=.3,n.stroke(),n.restore()}function o(){b.clearRect(0,0,m.width,m.height);for(let n=0;n<s.length;n++){const a=s[n];i(b,a.x,a.y,a.size,a.alpha),a.alpha-=.01,a.alpha<=0&&(s.splice(n,1),n--)}requestAnimationFrame(o)}o()}function F(e){localStorage.setItem("moonlike-echo",e);let t=JSON.parse(localStorage.getItem("moonlike-echo-history")||"[]");t.includes(e)||(t.push(e),localStorage.setItem("moonlike-echo-history",JSON.stringify(t)))}function B(){const e=document.getElementById("echo-list"),t=document.getElementById("echo-log"),s=localStorage.getItem("moonlike-echo-history");if(!s||!e||!t)return;const i=JSON.parse(s);e.innerHTML="",i.forEach(o=>{const n=document.createElement("li");n.textContent=o,e.appendChild(n)}),t.classList.add("visible")}function W(){localStorage.removeItem("moonlike-echo"),localStorage.removeItem("moonlike-echo-history")}function N(e,t=[]){e&&document.body.addEventListener("click",s=>{const i=s.target;t.some(n=>i.closest(n))||(e.paused?e.play().catch(()=>{}):e.pause())})}const S=["You arrived exactly when you were meant to.","The gravity here feels optional.","Nothing happens here, but you feel everything.","Someone dreamed of you before you existed.","This place is made of memory and static.","The stars don’t speak – they listen.","It’s always night here, but no one sleeps.","You’re not lost. You’re just early."];function p(){const e=Math.floor(Math.random()*S.length);return S[e]}function x(){const e=document.getElementById("blackout-flash");e&&(e.style.opacity="1",setTimeout(()=>{e.style.opacity="0"},400))}function C(){const e=Math.floor(Math.random()*6e4)+3e4;setTimeout(()=>{x(),C()},e)}function A(){const e=document.getElementById("fragment");e&&(e.classList.add("glitch"),setTimeout(()=>{e.classList.remove("glitch")},500))}function v(e,t){if(!e)return;const s=Math.floor(Math.random()*2e4)+1e4;setTimeout(()=>{t||(A(),setTimeout(()=>{e.textContent=p(),v(e,t)},300))},s)}let T;function R({whisperId:e="inactivity-whisper",delay:t=6e4,shiftedRef:s}){const i=document.getElementById(e);function o(){i&&!s()&&i.classList.add("visible")}function n(){i&&i.classList.remove("visible")}function a(){clearTimeout(T),n(),T=setTimeout(()=>{o()},t)}window.addEventListener("mousemove",a),a()}const k={fragmentEl:document.getElementById("fragment"),portal:document.getElementById("portal"),container:document.querySelector(".container"),echoInput:document.getElementById("echo-input"),echoBox:document.getElementById("echo-container"),echoList:document.getElementById("echo-list"),echoLog:document.getElementById("echo-log"),reentryMessage:document.getElementById("reentry-message"),returnBtn:document.getElementById("return-btn"),blackoutFlash:document.getElementById("blackout-flash"),inactivityWhisper:document.getElementById("inactivity-whisper"),audio:document.getElementById("bg-audio"),starsCanvas:document.getElementById("stars"),shiftSound:document.getElementById("shift-sound"),message:document.getElementById("hidden-message"),starsCanvas:document.getElementById("stars")};function $(e){const{fragmentEl:t,portal:s,echoBox:i,echoInput:o,reentryMessage:n,shiftSound:a,container:r,message:d}=k;t&&(t.textContent=p(),v(t,e()),t.addEventListener("click",()=>{e(!0),document.body.classList.add("shifted"),a&&(a.volume=.4,a.play().catch(()=>{})),r==null||r.classList.add("fade-out","blur"),d==null||d.classList.add("gone"),t.textContent="",setTimeout(()=>{t.classList.add("fade-in"),r.classList.remove("blur"),t.textContent="You’re now within.",setTimeout(()=>{r==null||r.classList.remove("fade-out")},100)},500),i&&(i.classList.remove("hidden"),i.classList.add("visible"),B()),s&&setTimeout(()=>{s.classList.add("visible"),t.style.display="none"},4e3);let h;o==null||o.addEventListener("input",z=>{const w=z.target.value.trim();clearTimeout(h),w!==""&&(h=setTimeout(()=>{F(w),B()},2e3))}),localStorage.getItem("moonlike-echo")&&n&&setTimeout(()=>{n.classList.add("visible")},3e3)}))}function H(){const e=document.getElementById("return-btn");e&&e.addEventListener("click",()=>{var o,n;(o=document.querySelector(".second-layer"))==null||o.remove(),(n=document.getElementById("infinity-canvas"))==null||n.remove();const t=document.getElementById("container"),s=document.getElementById("portal"),i=document.getElementById("fragment");t&&s&&i&&(t.style.display="block",s.classList.remove("hidden"),s.classList.add("visible"),i.classList.remove("fragment-fade"),i.style.display="block",i.textContent="You’re now within."),g()})}function J(){const{portal:e,fragmentEl:t,container:s}=k;!e||!t||e.addEventListener("click",()=>{document.body.classList.add("portal-transition"),t.classList.remove("fragment-fade"),t.textContent="",e.classList.remove("visible"),setTimeout(()=>{s.style.display="none",["echo-log","echo-container","reentry-message","hidden-message","fragment"].forEach(n=>{var a;(a=document.getElementById(n))==null||a.remove()});const i=document.createElement("div");i.classList.add("second-layer"),i.innerHTML="<p>You've crossed into the place where nothing remains... and yet something always returns.</p>",document.body.appendChild(i);const o=document.createElement("button");o.id="return-btn",o.innerText="Return",i.appendChild(o),O(),H()},1e3),setTimeout(()=>{const i=document.createElement("canvas");i.id="infinity-canvas",i.style.display="block",i.style.width="100vw",i.style.height="100vh",document.body.appendChild(i),q(i),Y()},1e3)})}const j=document.getElementById("stars");P(j);g();let E=!1;const D=()=>E,X=e=>{E=e};$(e=>(e!==void 0&&X(e),D()));J();const u=document.getElementById("fragment");u.textContent=p();u.textContent=p();v(u,E);R({shiftedRef:()=>E});const M=document.querySelector(".container");document.getElementById("hidden-message");document.getElementById("shift-sound");const G=document.createElement("button");x();C();v();N(document.getElementById("bg-audio"),["#portal","#return-btn","#exit-btn",".echo-button","#echo-input"]);setTimeout(()=>{const e=document.getElementById("hidden-message");e&&e.classList.add("visible")},7e3);console.log("You’re not lost. You’re just early.");const I=document.getElementById("exit-btn");I==null||I.addEventListener("click",()=>{W();const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="#000",e.style.transition="opacity 2s ease",e.style.opacity="0",e.style.zIndex="9999",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="1"},10),setTimeout(()=>{location.reload()},3e3)});G.addEventListener("click",()=>{var e,t,s;(e=document.querySelector(".second-layer"))==null||e.remove(),(t=document.getElementById("infinity-canvas"))==null||t.remove(),M.style.display="block",(s=document.getElementById("portal"))==null||s.classList.add("visible"),u.style.display="block",u.textContent="You’re now within.",document.body.classList.add("shifted"),M.classList.add("fade-out","blur"),g()});
